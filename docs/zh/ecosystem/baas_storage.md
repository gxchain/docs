# BaaSå­˜å‚¨APIä»‹ç»

æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•å¿«é€Ÿè°ƒç”¨å…¬ä¿¡å®BaaS å­˜å‚¨APIï¼Œé€‚ç”¨äºAPIå¼€å‘è€…ï¼Œéœ€è¦ä¸€å®šçš„ç¼–ç¨‹åŸºç¡€ã€‚å› ä¸»é“¾å­˜åœ¨å­˜å‚¨ç©ºé—´å¤§å°çš„é™åˆ¶ï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ³•æ˜¯å°†æ–‡ä»¶æœ¬ä½“å­˜å‚¨åœ¨ä¾§é“¾ï¼ˆIPFSï¼‰ä¸Šï¼Œå°†ä¾§é“¾äº§ç”Ÿçš„æ–‡ä»¶C-IDè¿”è¿˜è‡³ä¸»é“¾è¿›è¡Œå­˜è¯ã€‚åœ¨ä¸»é“¾ä¸Šä¿å­˜çš„C-IDå’Œæ—¶é—´æˆ³å¯ä»¥ä¿è¯ä¸Šé“¾æ•°æ®ä¸å¯ç¯¡æ”¹çš„åŸºæœ¬åŸåˆ™ã€‚

![](./assets/baas.png)

## 1. åˆ›å»ºå¸æˆ·

é¦–å…ˆï¼Œä½ éœ€è¦æ‹¥æœ‰ä¸€ä¸ªå…¬ä¿¡å®é’±åŒ…å¸æˆ·ï¼Œç”¨äºè°ƒç”¨ BaaSå­˜å‚¨æœåŠ¡æ—¶ï¼Œæ”¯ä»˜å­˜å‚¨è´¹ç”¨å¹¶åœ¨åŒºå—é“¾ä¸Šè®°å¸ã€‚

å¦‚æœå·²ç»æ‹¥æœ‰å…¬ä¿¡å®é’±åŒ…å¸æˆ·ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

å¦‚æœè¿˜æ²¡æœ‰å…¬ä¿¡å®é’±åŒ…å¸æˆ·ï¼Œå¯ä»¥é€šè¿‡æ‰‹æœºé’±åŒ…ã€ç½‘é¡µé’±åŒ…åˆ›å»ºå¸æˆ·ã€‚

PCç«¯é’±åŒ…/ç½‘é¡µé’±åŒ…ä½¿ç”¨æ•™ç¨‹:

1. æ³¨å†Œå’Œå¤‡ä»½æ•™ç¨‹ï¼š[http://mp.weixin.qq.com/s/eNQyqY5dyaP299J5qra0Bg](http://mp.weixin.qq.com/s/eNQyqY5dyaP299J5qra0Bg)
2. æ¢å¤å’Œå¯¼å…¥æ•™ç¨‹ï¼š[http://mp.weixin.qq.com/s/27v540tvhfDHF6Bv5\_ObKQ](http://mp.weixin.qq.com/s/27v540tvhfDHF6Bv5_ObKQ)

æ‰‹æœºé’±åŒ…æ•™ç¨‹ï¼š[https://forum.gxb.io/topic/130/gxs-ç§»åŠ¨ç«¯é’±åŒ…å‘å¸ƒ-è¯´æ˜æ–‡æ¡£-ioså®¡æ ¸å·²é€šè¿‡](https://forum.gxb.io/topic/130/gxs-ç§»åŠ¨ç«¯é’±åŒ…å‘å¸ƒ-è¯´æ˜æ–‡æ¡£-ioså®¡æ ¸å·²é€šè¿‡)

## 2. å¯¼å‡ºç§é’¥

ä»æ‰‹æœºé’±åŒ…æˆ–è€…ç½‘é¡µé’±åŒ…å¯¼å‡ºå¸æˆ·çš„æ´»è·ƒæƒé™ç§é’¥ï¼Œä¾›åé¢è°ƒç”¨SDKæ—¶ä½¿ç”¨ã€‚

## 3. BaaSå­˜å‚¨æœåŠ¡åœ°å€

* çº¿ä¸Šæ­£å¼åœ°å€:  `https://baas.gxchain.cn/api/storage`
* çº¿ä¸Šå¼€å‘è€…æµ‹è¯•åœ°å€: `https://baas-developer.gxchain.cn/api/storage`

## 4. å¦‚ä½•è°ƒç”¨SDK

SDKæä¾›äº†å’ŒBaaSå­˜å‚¨æœåŠ¡äº¤äº’çš„æ–¹æ³•å°è£…ã€‚ç›®å‰æš‚æ—¶æä¾›Javaç‰ˆæœ¬çš„SDKï¼Œåç»­ä¼šæ”¯æŒå¤šç§è¯­è¨€ã€‚

### Java - maven

* mavenä»“åº“åœ°å€\(HTML View\): `https://repo.gxchain.cn/service/rest/repository/browse/maven-public/`
* mavenä»“åº“å¼•å…¥åœ°å€: `https://repo.gxchain.cn/repository/maven-public/`

::: warning æç¤º
å¦‚æœæ— æ³•å¼•å…¥åŒ…ï¼Œè¯·å°†httpsæ›´æ¢æˆhttpå°è¯•ä¸€ä¸‹
:::

#### maven setting.xml

```xml
<mirror>
    <id>gxchain</id>
    <mirrorOf>*</mirrorOf>
    <url>http://repo.gxchain.cn/repository/maven-public/</url>
</mirror>
```

#### pom dependency

```xml
<dependency>
    <groupId>com.gxb.block.baas</groupId>
    <artifactId>baas-sdk-client</artifactId>
    <version>1.0.2-RELEASE</version>
</dependency>
```

### Node - npm

`npm install baas-sdk-node`

## 5. BaaSå­˜å‚¨æœåŠ¡APIæ¥å£

| æ¥å£ | æè¿° |
| :--- | :--- |
| [provider](#provideræ¥å£) | è·å–æœåŠ¡æä¾›æ–¹ä¿¡æ¯ |
| [store](#storeæ¥å£) | æ•°æ®å­˜å‚¨æ¥å£ |
| [data](#dataæ¥å£) | è·å–æ•°æ®æ¥å£ï¼Œæ ¹æ®cidè·å–æ•°æ® |

### provideræ¥å£

é€šè¿‡æŒ‡å®šè·¯å¾„è·å–æœåŠ¡æ–¹æä¾›çš„ä¿¡æ¯

- è¯·æ±‚åœ°å€

GET /provider

- è¯·æ±‚å‚æ•°
æ— 

- ä¾‹å­ï¼ˆä»¥curlä¸ºä¾‹ï¼‰
```sh
curl https://baas.gxchain.cn/api/storage/provider
```

- å“åº”è¿”å›

```js
{
    "code":200,
    "msg":"ok",
    "data":{
        "account_id":"1.2.639287", // æä¾›æ–¹æ­£å¼ç¯å¢ƒbaas account id
        "name":"GXChain Official BaaS Storage",
        "description":"å…¬ä¿¡å®BaaSå­˜å‚¨+å­˜è¯æœåŠ¡",
        "fees":[ // æ”¯æŒçš„æ”¯ä»˜èµ„äº§ç±»å‹ä»¥åŠè´¹ç‡
            {"fee_per_kbytes": 20, "asset_id":"1.3.1"}
        ]
    }
}
```

- SDKç¤ºä¾‹-JAVA

```java
return new BaasDefaultClient(URL_HEADER + "storage/provider").execute(new ProviderReq());
```

å¯å‚è€ƒ**com.gxb.block.baas.sdk.client.api.BaasConstants**ç±»


### storeæ¥å£

è°ƒç”¨æ–¹é€šè¿‡è¯¥æ¥å£å¯æŠŠè‡ªå·±çš„æ•°æ®é€šè¿‡baaså¹³å°æœåŠ¡æœ‰å¿ä¸Šé“¾ã€‚

- è¯·æ±‚åœ°å€

POST /store

Content-Type= **multipart/form-data**

- è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | æœ€å¤§é•¿åº¦ | æè¿° | ç¤ºä¾‹ |
| --- | --- | --- | --- | --- | --- |
| data | byte/File | Y | ä¸è¶…è¿‡10MB | è¦å­˜å‚¨çš„åŸå§‹æ•°æ® | 12345678asdfg\(\)\_:&lt;&gt;!@\#$%^&\*=-';\" ' |

è¯´æ˜ï¼š
- å­˜å‚¨å›ºå®šæ¶ˆè€—GXSï¼Œæœ€å°å•ä½ä¸º 0.0002/kb.
- æ•°æ®å¤§å°é™åˆ¶åç»­ä¼šæ”¾å¼€

- å“åº”å‚æ•°

| å‚æ•° | ç±»å‹ | æ˜¯å¦å¿…å¡« | æœ€å¤§é•¿åº¦ | æè¿° | ç¤ºä¾‹ |
| --- | --- | --- | --- | --- | --- |
| txid | String | Y | 64 | åŒºå—äº¤æ˜“ID | d4763fd0d802473579ae2dcaa2c6707adf4f2e7e |
| cid | String | Y | 64 | IPFSå­˜å‚¨çš„CIDå€¼ | QmaZrwThXyZm8Rxs93Tih3L6p4Q8NqYEXp32iN4PeAqDgv |

ä¾‹å­

```js
{
    "code":200,
    "msg":"ok",
    "data":{
        "cid":"QmaZrwThXyZm8Rxs93Tih3L6p4Q8NqYEXp32iN4PeAqDgv",
        "txid":"d4763fd0d802473579ae2dcaa2c6707adf4f2e7e"
    }
}
```

- SDKç¤ºä¾‹-JAVA

```java
// build store client
// EXAMPLE_ACCOUNT is your account id
// EXAMPLE_PRIVATE_KEY is your account private key
// EXAMPLE_PUBLIC_KEY is your account public key
// * Attention: Your EXAMPLE_PRIVATE_KEY and EXAMPLE_PUBLIC_KEY can not be uploaded.
StoreClient client = new StoreClient(EXAMPLE_ACCOUNT, EXAMPLE_PRIVATE_KEY, EXAMPLE_PUBLIC_KEY);
// response
StoreDataResp resp = client.store("Hello World!".getBytes());
```

```
å…·ä½“å‚ç…§ com.gxb.block.baas.sdk.client.api.client.StoreClient
```
çº¿ä¸Šå¸æˆ·çš„id, å¸æˆ·æ´»è·ƒæƒé™å…¬é’¥å¯ä»¥åœ¨å…¬ä¿¡å®åŒºå—æµè§ˆå™¨ä¸Šæ ¹æ®å¸æˆ·åè·å¾—ï¼š

åŒºå—æµè§ˆå™¨åœ°å€: [https://block.gxb.io/#/](https://block.gxb.io/#/)

**ä¹Ÿå¯ä»¥é€šè¿‡[provideræ¥å£](#provideræ¥å£)æ¥å£è·å–åˆ°çº¿ä¸Šæ­£å¼ç¯å¢ƒä¸å¼€å‘è€…æµ‹è¯•ç¯å¢ƒå¯¹åº”çš„BaaSè´¦æˆ·id**

```js
# ä»¥å¸æˆ·ågxs-devä¸ºä¾‹ï¼Œparamsä¼ å…¥å¸æˆ·å
curl --data '{"jsonrpc": "2.0", "method": "get_account_by_name", "params": ["gxs-dev"], "id": 1}' https://node1.gxb.io

# å“åº”
{
    "id": 1,
    "jsonrpc": "2.0",
    "result": {
        "id": "1.2.639290",  // å¸æˆ·id
        "membership_expiration_date": "1970-01-01T00:00:00",
...
...
        "lifetime_referrer_fee_percentage": 3000,
        "referrer_rewards_percentage": 0,
        "name": "gxs-dev",  // å¸æˆ·å
        "owner": {
            "weight_threshold": 1,
            "account_auths": [],
            "key_auths": [
                ["GXC85WbsFPSRjRto4n4gbopwGBEf41iroDesrNxN1WXJLTb9Mv2sc", 1]
            ],
            "address_auths": []
        },
        "active": { // æ´»è·ƒæƒé™
            "weight_threshold": 1,
            "account_auths": [],
            "key_auths": [
                ["GXC7xQNvkevq5fkCZPfi7rLTXZb1WKfE41sDTxqf7xUg36BLbZLvh", 1] // æ´»è·ƒæƒé™å…¬é’¥
            ],
            "address_auths": []
        },
...
...
    }
}
```

- é”™è¯¯æƒ…å†µ

| code | msg | æè¿° |
| --- | --- | --- |
| 401 | DATA\_SIGN\_FAILURE | éªŒç­¾å¤±è´¥ |
| 402 | BALANCE\_NO\_ENOUGH | è´¦æˆ·ä½™é¢ä¸è¶³ |
| 404 | REQ\_EXPIRATION | è¯·æ±‚è¿‡æœŸ |
| 405 | DATA\_MD5\_INVALID | æ•°æ®MD5ä¸é€šè¿‡ |
| 406 | ACCOUNT\_NO\_EXIT | è´¦æˆ·ä¸å­˜åœ¨ |
| 407 | DATA\_OVER\_SIZE | æ•°æ®é•¿åº¦è¿‡é•¿ |
| 408 | AMOUNT\_INVALID | é‡‘é¢ä¸åˆè¦æ±‚ |


### dataæ¥å£

é€šè¿‡Cidå€¼è·å–å¯¹åº”å­˜çš„æ•°æ®

- è¯·æ±‚åœ°å€

GET /data/{cid}

- è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | æœ€å¤§é•¿åº¦ | æè¿° | ç¤ºä¾‹ |
| --- | --- | --- | --- | --- | --- |
| cid | String | Y | 64 | å­˜å‚¨æ•°æ®çš„Cidå€¼ | QmaZrwThXyZm8Rxs93Tih3L6p4Q8NqYEXp32iN4PeAqDgv |

ä¾‹å­ï¼š

```js
GET /api/data/QmaZrwThXyZm8Rxs93Tih3L6p4Q8NqYEXp32iN4PeAqDgv
```

- å“åº”è¿”å›

è¿”å›ä¸€ä¸ª QmaZrwThXyZm8Rxs93Tih3L6p4Q8NqYEXp32iN4PeAqDgv.baas çš„æ–‡ä»¶

- SDKç¤ºä¾‹-JAVA

```java
// build store client
// EXAMPLE_ACCOUNT is your account id
// EXAMPLE_PRIVATE_KEY is your account private key
// EXAMPLE_PUBLIC_KEY is your account public key
// * Attention: Your EXAMPLE_PRIVATE_KEY and EXAMPLE_PUBLIC_KEY can not be uploaded.
StoreClient client = new StoreClient(EXAMPLE_ACCOUNT, EXAMPLE_PRIVATE_KEY, EXAMPLE_PUBLIC_KEY, false);
// byte[]
byte[] result = client.getRawBytes(CID);
// String
String str = client.getRawString(CID);
// File
String file = client.downloadFile(CID,TARGET_FILE); // TARGET_FILE is java.io.File.
```

- é”™è¯¯æƒ…å†µ

| code | msg | æè¿° |
| --- | --- | --- |
| 401 | NO\_EXIT | ä¸å­˜åœ¨ |

